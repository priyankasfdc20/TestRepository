function getUrlParameter(a,b){var c=null,d=a.split(b);return d.length>1&&(c=d[1],-1!=c.indexOf("&")&&(c=c.substring(0,c.indexOf("&"))),-1!=c.indexOf("#/")&&(c=c.substring(0,c.indexOf("#/")))),c}function getAuthCodeParameter(a){return getUrlParameter(a,"?auth_code=")}function getRegistrationCodeParameter(a){return getUrlParameter(a,"&registrationCode=")}function getErrorHandlerUrlParameter(a){return getUrlParameter(a,"&errorHandlerUrl=")}function showError(a,b){if(errorHandlerUrl){var c=window.atob(errorHandlerUrl);c+=-1==c.indexOf("?")?"?":"&",c+="errorType="+b["error-type"]+"&errorCode="+b["error-code"],window.location.href=c}else a.go("error",{errorType:b["error-type"],errorCode:b["error-code"]})}var workSpacesApp=angular.module("workSpacesApp",["ui.router","ngCookies","ngAnimate","workSpacesControllers"]);workSpacesApp.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("main"),$stateProvider.state("main",{url:"/main:registrationCode",templateUrl:"partials/main.html",controller:"MainController"}).state("registration",{url:"/registration",templateUrl:"partials/registration.html",controller:"RegistrationController"}).state("login",{url:"/login",templateUrl:"partials/main.html",controller:"LoginController"}).state("error",{url:"/error/:errorType/:errorCode",templateUrl:"partials/error.html",controller:"ErrorController"})});var workSpacesApp=angular.module("workSpacesApp"),TAG="connection-manager-service.js",HTTP_ONLY_SECURE=";HttpOnly;Secure";workSpacesApp.service("connectionManagerService",["logger","$q","$http","$cookies","registrationService","metricsService","storageService",function(a,b,c,d,e,f,g){function h(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})}var i=this;i.ERR_CM_AUTH_NO_RESULT_ID="ERR_CM_AUTH_NO_RESULT_ID",i.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",i.ERR_DEVICE_ACCESS_DENIED="ERR_DEVICE_ACCESS_DENIED",i.ERR_DOMAIN_NOT_FOUND="ERR_DOMAIN_NOT_FOUND",i.ERR_CM_REQUEST_FAILED="ERR_CM_REQUEST_FAILED",i.ERR_SERVICE_UNAVAILABLE="ERR_SERVICE_UNAVAILABLE",i.ERR_CM_SESSION_TIMEOUT="ERR_CM_SESSION_TIMEOUT",i.ERR_PLATFORM_DENIED="ERR_PLATFORM_DENIED",i.ERR_GET_LOCAL_REGCODE_FAILED="ERR_GET_LOCAL_REGCODE_FAILED",i.ERR_INVALID_REG_CODE="ERR_INVALID_REG_CODE",i.ERR_USER_AUTH_FAILURE="ERR_USER_AUTH_FAILURE",i.ERR_DEVICE_AUTH_FAILURE="ERR_DEVICE_AUTH_FAILURE",i.ERR_RESOURCE_NOT_FOUND="ERR_RESOURCE_NOT_FOUND",i.ERR_CM_ALLOC_RETRY_TIMEOUT="ERR_CM_ALLOC_RETRY_TIMEOUT",i.allocationRetryTimeout=30,i.pendingRetryDuration=0,i.allocateResourcePromise={},i.usePCM=!0,i.getConnectionManagerUrl=function(){var b=e.getEndpointcode(),c=null;switch(b){case"integ.iad":c="https://skylightpcmanager.integ.amazon.com";break;case"beta.iad":c="https://ws-broker-service-beta-iad.iad.proxy.amazon.com",i.usePCM=!1;break;case"fips.beta.iad":c="https://ws-broker-fips-service-beta-iad.iad.proxy.amazon.com",i.usePCM=!1;break;case"gamma.pdx":c="https://ws-broker-service-gamma.us-west-2.amazonaws.com",i.usePCM=!1;break;case"fips.gamma.pdx":c="https://ws-broker-service-fips-gamma.us-west-2.amazonaws.com",i.usePCM=!1;break;case"prod.iad":c="https://ws-broker-service.us-east-1.amazonaws.com",i.usePCM=!1;break;case"fips.prod.iad":c="https://ws-broker-service-fips.us-east-1.amazonaws.com",i.usePCM=!1;break;case"prod.pdx":c="https://ws-broker-service.us-west-2.amazonaws.com",i.usePCM=!1;break;case"fips.prod.pdx":c="https://ws-broker-service-fips.us-west-2.amazonaws.com",i.usePCM=!1;break;case"prod.dub":c="https://ws-broker-service.eu-west-1.amazonaws.com",i.usePCM=!1;break;case"prod.syd":c="https://ws-broker-service.ap-southeast-2.amazonaws.com",i.usePCM=!1;break;case"prod.nrt":c="https://ws-broker-service.ap-northeast-1.amazonaws.com",i.usePCM=!1;break;case"prod.sin":c="https://ws-broker-service.ap-southeast-1.amazonaws.com",i.usePCM=!1;break;case"prod.fra":c="https://ws-broker-service.eu-central-1.amazonaws.com",i.usePCM=!1;break;case"prod.lhr":c="https://ws-broker-service.eu-west-2.amazonaws.com",i.usePCM=!1;break;case"prod.yul":c="https://ws-broker-service.ca-central-1.amazonaws.com",i.usePCM=!1;break;case"prod.gru":c="https://ws-broker-service.sa-east-1.amazonaws.com",i.usePCM=!1;break;case"prod.icn":c="https://ws-broker-service.ap-northeast-2.amazonaws.com",i.usePCM=!1;break;case"prod.pdt":c="https://ws-broker-service.us-gov-west-1.amazonaws.com",i.usePCM=!1;break;case"fips.prod.pdt":c="https://ws-broker-service-fips.us-gov-west-1.amazonaws.com",i.usePCM=!1;break;default:a.error(TAG,"Unknown endpoint code: "+b)}return c},i.sendPcmPostRequest=function(d){var e=i.getConnectionManagerUrl(),f="/pcoip-broker/xml",g=b(function(a,b){i.resolvePostRequest=a,i.rejectPostRequest=b}),h=e+f,j={"Content-Type":"text/xml;charset=UTF-8"};return i.sessionId&&(j["Set-Cookie"]="JSESSIONID="+i.sessionId),c({method:"POST",url:h,data:d,headers:j}).then(function(b){a.info(TAG,"Successfully obtained pcm result data: "+JSON.stringify(b));var c=b.headers("x-amzn-sessionid");if(c&&(i.sessionId=c,-1!=i.sessionId.indexOf("JSESSIONID=")&&-1!=i.sessionId.indexOf(HTTP_ONLY_SECURE))){var d=i.sessionId.split(";"),e=d[0];d=e.split("="),i.sessionId=d[1]+HTTP_ONLY_SECURE}i.resolvePostRequest(b)},function(b){a.error(TAG,"Error getting pcm data: "+JSON.stringify(b)),i.rejectPostRequest(b)}),g},i.sendPostRequest=function(d,e){var f=i.getConnectionManagerUrl(),g=b(function(a,b){i.resolvePostRequest=a,i.rejectPostRequest=b}),j={Accept:"application/json, text/javascript, */*","x-amzn-RequestId":h(),Connection:"Keep-Alive","Cache-Control":"no-cache","Content-Encoding":"amz-1.0","X-Amz-Target":"com.amazonaws.wsbrokerservice.WSBrokerService."+e};return c({method:"POST",url:f,data:d,headers:j}).then(function(b){a.info(TAG,"Successfully obtained broker result data: "+JSON.stringify(b)),i.resolvePostRequest(b)},function(b){a.error(TAG,"Error getting broker data: "+JSON.stringify(b)),i.rejectPostRequest(b)}),g},i.getWarpDriveUrl=function(){i.getConnectionManagerUrl();var c=b(function(a,b){i.resolve=a,i.reject=b}),d=e.getRegistrationCode();if(!d)return f.submitOperation(f.MetricOperation.GET_LOCAL_REGCODE_FAILURE),i.reject({"error-code":i.ERR_GET_LOCAL_REGCODE_FAILED,response:"ERR_GET_LOCAL_REGCODE_FAILED"}),c;f.submitOperation(f.MetricOperation.GET_LOCAL_REGCODE_SUCCESS);var h,j;return i.usePCM?h='<?xml version="1.0" encoding="UTF-8"?>\n<pcoip-client version="2.1" revision="0">\n    <hello>\n        <client-info>\n            <product-name>WorkSpaces Web client</product-name>\n            <product-version>'+g.getClientVersion()+"</product-version>\n            <platform>Web</platform>\n            <locale>en_US</locale>\n            <hostname>IP-Unknown</hostname>\n            <serial-number>MAC-Unknown</serial-number>\n            <device-name>WorkSpacesWebClient</device-name>\n        </client-info>\n        <caps>\n            <cap>CAP_OAUTH_AUTHENTICATION</cap>\n            <cap>CAP_TOKEN_AUTHENTICATION</cap>\n            <cap>CAP_ALLOC_PENDING_TRY_AGAIN</cap>            <cap>CAP_DEVICE_AUTHENTICATE_VIA_CERTIFICATE</cap>        </caps>\n        <client-to-broker-variables>\n            <variable>\n               <name>OID4843-registration-code</name>\n               <value>"+d+"</value>\n            </variable>\n        </client-to-broker-variables>\n    </hello>\n</pcoip-client>":j={Version:"1.0",AuthIdentifiers:{WS_REGISTRATION_CODE:[d]},ClientInfo:{Platform:"Web",AuthCapabilities:["OAUTH","TOKEN","DEVICE_VIA_CERTIFICATE"],Name:"WorkSpaces Web client",Version:g.getClientVersion(),Identifier:"sadax-ascas-..."}},f.startOperation(f.MetricOperation.HELLO),i.usePCM?i.sendPcmPostRequest(h).then(function(b){a.info(TAG,"Successfully obtained hello response: "+JSON.stringify(b)),f.submitOperation(f.MetricOperation.HELLO),f.submitOperation(f.MetricOperation.HELLO_SUCCESS);var c=b.data,e=(new DOMParser).parseFromString(c,"text/xml"),h=e.getElementsByTagName("result-id")[0]&&e.getElementsByTagName("result-id")[0].childNodes[0]?e.getElementsByTagName("result-id")[0].childNodes[0].nodeValue:"";if("HELLO_FAILED_DEVICE_ACCESS_DENIED"===h)return a.warn(TAG,"Web Access not allowed for RegCode "+d+". Hello Response: "+JSON.stringify(b)),i.reject({"error-code":i.ERR_DEVICE_ACCESS_DENIED,response:b});if("ERR_DOMAIN_NOT_FOUND"===h)return a.warn(TAG,"Domain not found for RegCode "+d+". Hello Response: "+JSON.stringify(b)),i.reject({"error-code":i.ERR_DOMAIN_NOT_FOUND,response:b});var j=e.getElementsByTagName("signed-url")[0].childNodes[0].nodeValue,k=j.substring(8,j.indexOf(".awsapps.com/"));g.save("organizationName",k);var l=j.split("&redirect_uri="),m=l[0],n="&redirect_uri=https://"+window.location.hostname+"/webclient";j=m+n,a.info(TAG,"Returning warp drive url: "+j),i.resolve(j)},function(b){return a.error(TAG,"Error sending hello request: "+JSON.stringify(b)),f.submitOperation(f.MetricOperation.HELLO_FAILURE),i.reject({"error-code":i.ERR_CM_REQUEST_FAILED,response:b})}):i.sendPostRequest(j,"GetAuthInfo").then(function(b){if("error_code"in b.data){var c=b.data.error_code;switch(f.submitOperation(f.MetricOperation.HELLO_FAILURE),a.error(TAG,"Error getting auth info: "+JSON.stringify(b)),c){case"INVALID_INPUT":c=i.ERR_INVALID_REG_CODE;break;case"SERVICE_UNAVAILABLE":c=i.ERR_SERVICE_UNAVAILABLE;break;case"ACCESS_DENIED":c=i.ERR_PLATFORM_DENIED}return i.reject({"error-code":c,response:b})}a.info(TAG,"Successfully obtained GetAuthInfo response: "+JSON.stringify(b)),f.submitOperation(f.MetricOperation.HELLO),f.submitOperation(f.MetricOperation.HELLO_SUCCESS),i.sessionId=b.data.SessionContext.SessionId;var d=b.data.AuthMethods[0].Url,e=d.substring(8,d.indexOf(".awsapps.com/"));g.save("organizationName",e);var h=d.split("&redirect_uri="),j=h[0],k="&redirect_uri=https://"+window.location.hostname+"/webclient";d=j+k,a.info(TAG,"Returning warp drive url: "+d),i.resolve(d)},function(b){f.submitOperation(f.MetricOperation.HELLO_FAILURE),a.error(TAG,"Error sending GetAuthInfo request: "+JSON.stringify(b)),i.reject({"error-code":i.ERR_CM_REQUEST_FAILED,response:b})}),c},i.authenticate=function(c,d){var e=b(function(a,b){i.resolve=a,i.reject=b});if(i.usePCM){var h="";d&&(h="        <login-uuid>"+d+"</login-uuid>\n");var j='<?xml version="1.0" encoding="UTF-8"?>\n<pcoip-client version="2.1" revision="0">\n    <authenticate method="AUTHENTICATE_VIA_OAUTH">\n        <auth-code>'+c+"</auth-code>\n"+h+"    </authenticate>\n</pcoip-client>";f.startOperation(f.MetricOperation.OAUTH),i.sendPcmPostRequest(j).then(function(b){a.info(TAG,"Successully authenticated: "+JSON.stringify(b));var c=b.data,d=(new DOMParser).parseFromString(c,"text/xml"),e=d.getElementsByTagName("result-id");if(e&&e.length>0){var h=e[0].childNodes[0].nodeValue;if("AUTH_SUCCESSFUL_AND_COMPLETE"==h){var j=d.getElementsByTagName("auth-token")[0].childNodes[0].nodeValue,k=d.getElementsByTagName("auth-token")[0].getAttribute("expires-at");try{for(var l=d.getElementsByTagName("variable"),m=0;m<l.length;m++){var n=l[m];"OID4843-allocation-retry-timeout"==n.getElementsByTagName("name")[0].childNodes[0].nodeValue&&(i.allocationRetryTimeout=parseInt(n.getElementsByTagName("value")[0].childNodes[0].nodeValue),a.info(TAG,"Setting allocationRetryTimeout to: "+i.allocationRetryTimeout)),"OID4843-external-directory-id"==n.getElementsByTagName("name")[0].childNodes[0].nodeValue&&(i.externallDirectoryId=n.getElementsByTagName("value")[0].childNodes[0].nodeValue,g.save("directoryId",i.externallDirectoryId),a.info(TAG,"directoryId: "+i.externallDirectoryId))}}catch(o){a.error(TAG,"Error parsing client variables in authenticate.")}f.submitOperation(f.MetricOperation.OAUTH),f.submitOperation(f.MetricOperation.OAUTH_SUCCESS),i.resolve({"auth-token":j,"expires-at":k})}else f.submitOperation(f.MetricOperation.OAUTH_FAILURE),i.reject({"error-code":h,response:b})}else i.reject({"error-code":i.ERR_CM_AUTH_NO_RESULT_ID,response:b})},function(a){i.reject({"error-code":i.ERR_CM_REQUEST_FAILED,response:a})})}else{var k={Version:"1.0",SessionContext:{SessionId:i.sessionId},AuthDetails:{MethodType:"USER",AuthType:"OAUTH",Token:c}};f.startOperation(f.MetricOperation.OAUTH),i.sendPostRequest(k,"Authenticate").then(function(b){if("error_code"in b.data){var c=b.data.error_code;switch(f.submitOperation(f.MetricOperation.OAUTH_FAILURE),a.error(TAG,"Error authenticating: "+JSON.stringify(b)),c){case"USER_AUTH_FAILURE":c=i.ERR_USER_AUTH_FAILURE;break;case"DEVICE_AUTH_FAILURE":c=i.ERR_DEVICE_AUTH_FAILURE;break;case"SERVICE_UNAVAILABLE":c=i.ERR_SERVICE_UNAVAILABLE;break;case"ACCESS_DENIED":c=i.ERR_PLATFORM_DENIED}return i.reject({"error-code":c,response:b})}a.info(TAG,"Successfully obtained Authenticate response: "+JSON.stringify(b)),f.submitOperation(f.MetricOperation.OAUTH),f.submitOperation(f.MetricOperation.OAUTH_SUCCESS),i.authToken=b.data.AuthToken.Value;var d=b.data.AuthToken.ExpirationTimestamp;i.resolve({"auth-token":i.authToken,"expires-at":d})},function(b){f.submitOperation(f.MetricOperation.OAUTH_FAILURE),a.error(TAG,"Error sending Authenticate request: "+JSON.stringify(b)),i.reject({"error-code":i.ERR_CM_REQUEST_FAILED,response:b})})}return e},i.supportsWebrtc=function(a){if(a&&a.length>0)for(var b=0;b<a.length;b++)if("WEBRTC"==a[b].childNodes[0].nodeValue)return!0;return!1},i.getResources=function(){var c=b(function(a,b){i.resolve=a,i.reject=b});if(i.usePCM){var d='<?xml version="1.0" encoding="UTF-8"?>\n<pcoip-client version="2.1" revision="0">\n    <get-resource-list>\n        <protocols>\n            <protocol>WEBRTC</protocol>\n        </protocols>\n        <resource-types>\n            <resource-type>DESKTOP</resource-type>\n        </resource-types>\n    </get-resource-list>\n</pcoip-client>';f.startOperation(f.MetricOperation.GET_RESOURCE_LIST),i.sendPcmPostRequest(d).then(function(b){a.info(TAG,"Successully obtained the resource list: "+JSON.stringify(b));var c=b.data,d=(new DOMParser).parseFromString(c,"text/xml"),e=d.getElementsByTagName("result-id")[0].childNodes[0].nodeValue;if("LIST_SUCCESSFUL"==e){var h=d.getElementsByTagName("protocol");if(i.supportsWebrtc(h)){var j=d.getElementsByTagName("resource-name")[0].childNodes[0].nodeValue,k=d.getElementsByTagName("resource-id")[0].childNodes[0].nodeValue,l=d.getElementsByTagName("resource-type")[0].childNodes[0].nodeValue,m=d.getElementsByTagName("resource-state")[0].childNodes[0].nodeValue;i.health_state=d.getElementsByTagName("health-state")[0].childNodes[0].nodeValue,g.save("workspaceId",k),f.submitOperation(f.MetricOperation.GET_RESOURCE_LIST),f.submitOperation(f.MetricOperation.GET_RESOURCE_LIST_SUCCESS),i.resolve({"resource-name":j,"resource-id":k,resource_type:l,"resource-state":m,"health-state":i.health_state})}else f.submitOperation(f.MetricOperation.GET_RESOURCE_LIST_UNSUPPORTED_PROTOCOL_ERROR),i.reject({"error-code":i.ERR_UNSUPPORTED_PROTOCOL,response:b})}else f.submitOperation(f.MetricOperation.GET_RESOURCE_LIST_FAILURE),i.reject({"error-code":e,response:b})},function(b){a.error(TAG,"Error getting pcm data: "+JSON.stringify(b)),i.reject({"error-code":i.ERR_CM_REQUEST_FAILED,response:b})})}else{var e={Version:"1.0",SessionContext:{SessionId:i.sessionId},AuthToken:{Value:i.authToken}};f.startOperation(f.MetricOperation.GET_RESOURCE_LIST),i.sendPostRequest(e,"GetResources").then(function(b){if("error_code"in b.data){var c=b.data.error_code;switch(f.submitOperation(f.MetricOperation.GET_RESOURCE_LIST_FAILURE),a.error(TAG,"Error getting resources: "+JSON.stringify(b)),c){case"UNAUTHORIZED_REQUEST":c=i.ERR_CM_SESSION_TIMEOUT;break;case"SERVICE_UNAVAILABLE":c=i.ERR_SERVICE_UNAVAILABLE;break;case"RESOURCE_NOT_FOUND":c=i.ERR_RESOURCE_NOT_FOUND}return i.reject({"error-code":c,response:b})}var d=b.data.Resources;if(0===d.length)return f.submitOperation(f.MetricOperation.GET_RESOURCE_LIST_FAILURE),a.error(TAG,"Error getting resources: "+JSON.stringify(b)),i.reject({"error-code":i.ERR_RESOURCE_NOT_FOUND,response:b});a.info(TAG,"Successfully obtained GetResources response: "+JSON.stringify(b)),f.submitOperation(f.MetricOperation.GET_RESOURCE_LIST),f.submitOperation(f.MetricOperation.GET_RESOURCE_LIST_SUCCESS);var e=d[0];i.resolve({"resource-name":e.ResourceDetails.WorkSpaceName,"resource-id":e.ResourceId,"resource-type":e.ResourceType,"resource-state":e.State,"health-state":"HEALTHY"})},function(b){f.submitOperation(f.MetricOperation.GET_RESOURCE_LIST_FAILURE),a.error(TAG,"Error sending GetResources request: "+JSON.stringify(b)),i.reject({"error-code":i.ERR_CM_REQUEST_FAILED,response:b})})}return c},i.fixCreds=function(a){return a&&(-1!=a.indexOf("signalingConfiguration")&&(a=a.replace("signalingConfiguration","SignalingConfiguration")),-1!=a.indexOf("iceConfiguration")&&(a=a.replace("iceConfiguration","IceConfiguration"))),a},i.allocateResource=function(c){i.suspendedStateCallback=c.suspendedStateCallback,i.allocateResourcePromise.promise||(i.allocateResourcePromise.promise=b(function(a,b){i.allocateResourcePromise.resolve=a,i.allocateResourcePromise.reject=b}));var d=c.resource_id;if(f.startOperation(f.MetricOperation.ALLOCATE_RESOURCE),i.usePCM){var e='<?xml version="1.0" encoding="UTF-8"?>\n<pcoip-client version="2.1" revision="0">\n    <allocate-resource>\n        <resource-id>'+d+"</resource-id>\n        <protocol>WEBRTC</protocol>\n        <client-info>\n            <time-zone-windows>Pacific Standard Time</time-zone-windows>\n            <ip-address>127.0.0.1</ip-address>\n            <mac-address>00:00:00:00:00:00</mac-address>\n        </client-info>\n    </allocate-resource>\n</pcoip-client>";i.sendPcmPostRequest(e).then(function(b){a.info(TAG,"Successfully allocated resource: "+JSON.stringify(b));var c=b.data,e=(new DOMParser).parseFromString(c,"text/xml"),g=e.getElementsByTagName("result-id")[0].childNodes[0].nodeValue;if("ALLOC_SUCCESSFUL"==g){f.submitOperation(f.MetricOperation.ALLOCATE_RESOURCE),f.submitOperation(f.MetricOperation.ALLOCATE_RESOURCE_SUCCESS);var h=e.getElementsByTagName("value")[0].childNodes[0].nodeValue;h=i.fixCreds(h),h=JSON.parse(h),i.allocateResourcePromise.resolve(h),i.allocateResourcePromise.promise=null}else if("ALLOC_PENDING_TRY_AGAIN"==g){a.info(TAG,"WorkSpace may be hibernating."),i.suspendedStateCallback(i.ALLOC_PENDING_TRY_AGAIN);var j=e.getElementsByTagName("allocation-retry-time")[0].childNodes[0].nodeValue;j=parseInt(j),i.allocationRetryTimeout-=j,i.allocationRetryTimeout>0?(a.info(TAG,"Retrying allocate-resource in "+j+" seconds."),a.info(TAG,"allocate-resource retries will time out in: "+i.allocationRetryTimeout+" seconds."),setTimeout(function(){i.allocateResource({resource_id:d,suspendedStateCallback:i.suspendedStateCallback})},1e3*j)):(a.error(TAG,"Exhausted all retries for allocate-resource."),i.allocateResourcePromise.reject({"error-code":i.ERR_CM_ALLOC_RETRY_TIMEOUT,response:b}),i.allocateResourcePromise.promise=null)}else f.submitOperation(f.MetricOperation.ALLOCATE_RESOURCE_FAILURE),i.allocateResourcePromise.reject({"error-code":g,response:b}),i.allocateResourcePromise.promise=null},function(b){a.error(TAG,"Error getting pcm data: "+JSON.stringify(b)),f.submitOperation(f.MetricOperation.ALLOCATE_RESOURCE_FAILURE),i.allocateResourcePromise.reject({"error-code":i.ERR_CM_REQUEST_FAILED,response:b}),i.allocateResourcePromise.promise=null})}else{var g={Version:"1.0",SessionContext:{SessionId:i.sessionId},AuthToken:{Value:i.authToken},Resource:{ResourceType:"WORKSPACE",ResourceId:d},Action:{ActionType:"CONNECT",ActionClientInput:{ClientIp:"127.0.0.1",ClientMacAddress:"00:00:00:00:00:00",Timezone:"UTC"},ActionUserInput:{Protocol:"WEBRTC"}}};i.sendPostRequest(g,"PerformResourceAction").then(function(b){if("error_code"in b.data){var c=b.data.error_code;switch(f.submitOperation(f.MetricOperation.ALLOCATE_RESOURCE_FAILURE),a.error(TAG,"Error allocating resource: "+JSON.stringify(b)),c){case"UNAUTHORIZED_REQUEST":c=i.ERR_CM_SESSION_TIMEOUT;break;case"SERVICE_UNAVAILABLE":c=i.ERR_SERVICE_UNAVAILABLE;break;case"RESOURCE_NOT_FOUND":c=i.ERR_RESOURCE_NOT_FOUND}return i.reject({"error-code":c,response:b})}var e=b.data.ActionResult,g=e.ResultType;if("SUCCESS_REDIRECT"==g){a.info(TAG,"Successfully allocated resource: "+JSON.stringify(b)),f.submitOperation(f.MetricOperation.ALLOCATE_RESOURCE),f.submitOperation(f.MetricOperation.ALLOCATE_RESOURCE_SUCCESS),i.pendingRetryDuration=0;var h=e.ResultValues.gatewaysConnectionInformation,j=JSON.parse(h).clientVariables.WEBRTC_SESSION_INFO;j=i.fixCreds(j),j=JSON.parse(j),i.allocateResourcePromise.resolve(j),i.allocateResourcePromise.promise=null}else if("PENDING_RETRY"==g){a.info(TAG,"WorkSpace may be hibernating."),i.suspendedStateCallback(g);var k=e.ResultValues.retryTimeoutSeconds,l=e.ResultValues.retryTimeSeconds;l=parseInt(l),k>i.pendingRetryDuration?(a.info(TAG,"Retrying allocate-resource in "+l+" seconds."),a.info(TAG,"allocate-resource retries will time out in: "+(k-i.pendingRetryDuration)+" seconds."),setTimeout(function(){i.pendingRetryDuration+=l,i.allocateResource({resource_id:d,suspendedStateCallback:i.suspendedStateCallback})},1e3*l)):(a.error(TAG,"Exhausted all retries ("+k+" sec) for allocate-resource."),i.pendingRetryDuration=0,i.allocateResourcePromise.reject({"error-code":i.ERR_CM_ALLOC_RETRY_TIMEOUT,response:b}),i.allocateResourcePromise.promise=null)}else f.submitOperation(f.MetricOperation.ALLOCATE_RESOURCE_FAILURE),i.allocateResourcePromise.reject({"error-code":g,response:b}),i.allocateResourcePromise.promise=null},function(b){f.submitOperation(f.MetricOperation.ALLOCATE_RESOURCE_FAILURE),a.error(TAG,"Error sending AllocateResource request: "+JSON.stringify(b)),i.allocateResourcePromise.reject({"error-code":i.ERR_CM_REQUEST_FAILED,response:b}),i.allocateResourcePromise.promise=null})}return i.allocateResourcePromise.promise}}]);var workSpacesApp=angular.module("workSpacesApp");workSpacesApp.service("errorHandlerService",["registrationService","connectionManagerService","streamingService",function(a,b,c){var d=this;d.ERROR_TYPE_REGISTRATION="ERROR_TYPE_REGISTRATION",d.ERROR_TYPE_AUTHENTICATION="ERROR_TYPE_AUTHENTICATION",d.ERROR_TYPE_WARPDRIVE="ERROR_TYPE_WARPDRIVE",d.ERROR_TYPE_CONNECTION="ERROR_TYPE_CONNECTION",d.ERROR_TYPE_GETRESOURCES="ERROR_TYPE_GETRESOURCES",d.ERROR_TYPE_UNSUPPORTED_PLATFORM="ERROR_TYPE_UNSUPPORTED_PLATFORM",d.ERR_UNSUPPORTED_PLATFORM="ERR_UNSUPPORTED_PLATFORM",d.hideError=function(a){a.isErrorContainerShowing=!1},d.showError=function(e,f){e.error={},e.error.title=$.i18n("ws-error");var g=f["error-code"];switch(f["error-type"]){case d.ERROR_TYPE_REGISTRATION:e.error.detail=[$.i18n("ws-reg-error")];break;case d.ERROR_TYPE_WARPDRIVE:e.error.detail=[$.i18n("ws-loading-error")];break;case d.ERROR_TYPE_AUTHENTICATION:e.error.detail=[$.i18n("ws-auth-error")];break;case d.ERROR_TYPE_GETRESOURCES:e.error.detail=[$.i18n("ws-get-resources-error")];break;case d.ERROR_TYPE_CONNECTION:g==c.ERR_PC_SETUP_FAILED?e.error.detail=[$.i18n("ws-starting-error"),$.i18n("ws-try-again-few-error")]:e.error.detail=[$.i18n("ws-connecting-error")];break;case d.ERROR_TYPE_UNSUPPORTED_PLATFORM:e.error.detail=[$.i18n("ws-not-supported-browser-error"),$.i18n("ws-try-chrome-error")]}switch(g){case a.ERROR_FORMAT:e.error.detail.push($.i18n("ws-reg-format-error"));break;case a.ERROR_PREFIX:e.error.detail.push($.i18n("ws-reg-invalid-error"));break;case b.ERR_INVALID_REG_CODE:e.error.detail.push($.i18n("ws-reg-invalid-error"));break;case b.ERR_USER_AUTH_FAILURE:e.error.detail.push($.i18n("ws-user-auth-failure"));break;case b.ERR_DEVICE_AUTH_FAILURE:e.error.detail.push($.i18n("ws-device-auth-failure"));break;case b.ERR_CM_ALLOC_RETRY_TIMEOUT:e.error.detail.push($.i18n("ws-suspended-error")),e.error.detail.push($.i18n("ws-try-again-error"));break;case b.ERR_RESOURCE_NOT_FOUND:e.error.detail.push($.i18n("ws-resource-not-found"));break;case b.ERR_SERVICE_UNAVAILABLE:e.error.detail.push($.i18n("ws-service-unavailable"));break;case b.ERR_CM_SESSION_TIMEOUT:e.error.detail.push($.i18n("ws-cm-session-timeout"));break;case b.ERR_DEVICE_ACCESS_DENIED:e.error.detail.push($.i18n("ws-os-error"));break;case b.ERR_PLATFORM_DENIED:e.error.detail.push($.i18n("ws-os-error"));break;case b.ERR_GET_LOCAL_REGCODE_FAILED:e.error.detail.push($.i18n("ws-reg-unknown-error"));break;case b.ERR_UNSUPPORTED_PROTOCOL:e.error.detail.push($.i18n("ws-not-supported-error"))}f["health-state"]&&"HEALTHY"!=f["health-state"]&&(e.error.detail=[$.i18n("ws-connecting-error")],e.error.detail.push($.i18n("ws-unhealthy-error")),e.error.detail.push($.i18n("ws-try-reboot-error"))),e.error.detail.push($.i18n("ws-contact-admin-error")),e.error.errorCode=g}}]);var workSpacesApp=angular.module("workSpacesApp"),TAG="logger-service.js";workSpacesApp.service("logger",["$filter","$http","storageService",function(a,b,c){var d=this;this.level={SENSITIVE:1,VERBOSE:2,INFO:3,WARN:4,ERROR:5,FATAL:6};var e=this.level;this.sensitive=function(a,b){return d.log(e.SENSITIVE,a,b)},this.verbose=function(a,b){return d.log(e.VERBOSE,a,b)},this.info=function(a,b){return d.log(e.INFO,a,b)},this.warn=function(a,b){return d.log(e.WARN,a,b)},this.error=function(a,b){return d.log(e.ERROR,a,b)},this.fatal=function(a,b){return d.log(e.FATAL,a,b)},d.stringToByteArray=function(a){var b,c,d=new Uint8Array(a.length);for(b=0,c=a.length;c>b;++b)d[b]=255&a.charCodeAt(b);return d},d.postCompressedData=function(a,c,e){var f={method:"POST",url:a,data:c,transformRequest:[],headers:{Accept:"text/*, application/octet-stream","Content-Type":"application/x-gzip","Content-Encoding":"gzip"}},g=3e4;b(f).then(function(a){console.log("Success sending log data."),d.deleteLogEntries(e)},function(a){console.log("Error sending log data: "+JSON.stringify(a)),setTimeout(function(){b(f).then(function(a){console.log("Success sending log data: "+JSON.stringify(a)),d.deleteLogEntries(e)},function(a){console.log("Error sending log data: "+JSON.stringify(a)),setTimeout(function(){b(f).then(function(a){console.log("Success sending log data: "+JSON.stringify(a)),d.deleteLogEntries(e)},function(a){console.log("Error sending log data: "+JSON.stringify(a)),d.deleteLogEntries(e),d.error(TAG,"Exhausted all attempts to publish the log entries so I had to delete them.  Sorry.")})},g)})},g)})},d.deleteLogEntries=function(a){for(var b=0;a>b;b++)sessionStorage.removeItem(sessionStorage.key(0))},d.publishLog=function(){for(var b=d.printLogHeaders(),c="",e=0,f=0;f<sessionStorage.length&&(0===f||sessionStorage.key(f)!=b);f++)c+=sessionStorage.getItem(sessionStorage.key(f))+"\n",e++;var g=d.stringToByteArray(c),h=new Zlib.Gzip(g),i=h.compress(),j="yyyy-MM-dd",k="HH:mm",l=a("date")(new Date,j,"PST"),m=a("date")(new Date,k,"PST"),n="https://fls-na.amazon.com/1/workspaces-client-crash-dumps/1/OP/"+l+"T"+m+"Z";console.log("Publishing log to URL: "+n),d.postCompressedData(n,i,e)},this.log=function(b,c,d){var f="%s UTC> [%s][%s] %s",g="yyyy-MM-ddTHH:mm:ss",h="yyyy-MM-ddTHH:mm:ss.sss",i=a("date")(new Date,g,"UTC"),j=a("date")(new Date,h,"UTC"),k="";switch(b){case e.SENSITIVE:k+=i+"Z> [SENSITIVE]["+c+"] "+d,console.log(f,j,"SENSITIVE",c,d);break;case e.VERBOSE:k+=i+"Z> [VERBOSE]["+c+"] "+d,console.log(f,j,"VERBOSE",c,d);break;case e.INFO:k+=i+"Z> [INFO]["+c+"] "+d,console.info(f,j,"INFO",c,d);break;case e.WARN:k+=i+"Z> [WARN]["+c+"] "+d,console.warn(f,j,"WARN",c,d);break;case e.ERROR:k+=i+"Z> [ERROR]["+c+"] "+d,console.error(f,j,"ERROR",c,d);break;case e.FATAL:k+=i+"Z> [FATAL]["+c+"] "+d,console.error(f,j,"FATAL",c,d);break;default:d="Unknown log level given: "+b+", message: "+d,k+=i+"Z> [DEFAULT]["+c+"] "+d,console.error(f,j,"DEFAULT",c,d)}var l="["+j+"][workspaces]["+Math.random()+"]";try{return sessionStorage.setItem(l,k),l}catch(m){return console.error("Error saving log entry to sessionStorage",m),null}},d.printLogHeaders=function(){var a=d.info(TAG,"aws_workspaces_web begins");return d.info(TAG,"Platform: Web  "+c.getOS()+" "+c.getPlatform()),d.info(TAG,"user-agent: "+c.getUserAgent()),d.info(TAG,"Amazon WorkSpaces v."+c.getClientVersion()+" Web Client is starting up"),d.info(TAG,"endpoint code: "+c.getEndpointcode()),d.info(TAG,"organization name: "+c.getOrganizationName()),d.info(TAG,"user-name: WEB"),a},d.publishLog()}]);var workSpacesApp=angular.module("workSpacesApp");workSpacesApp.service("metricsService",["logger","storageService",function(a,b){var c="metrics-service.js",d=this;d.STREAMING_ON="STREAMING_ON",d.metricToEvent={TxRoundTripTime:"SkyLight.Client.WorkspaceInSessionLatencyEvent",inSessionDisconnects:"SkyLight.Client.WorkspaceSessionDisconnectEvent",clientTotalLoginTime:"SkyLight.Client.WorkspaceConnectionLatencyEvent"},d.MetricOperation={REGISTER:"register",HELLO:"hello",WDLOGIN:"WDLogin",OAUTH:"OAuth",GET_RESOURCE_LIST:"getResourceList",ALLOCATE_RESOURCE:"allocateResource",SIGNALING:"ssig",STREAMING:"streaming",IN_SESSION_LATENCY:"TxRoundTripTime",SESSION_LAUNCH_TIME:"clientTotalLoginTime",REGISTER_SUCCESS:"registerSuccess",REGISTER_403_ERROR:"register403Error",REGISTER_FAILURE:"registerFailure",HELLO_SUCCESS:"helloSuccess",HELLO_FAILURE:"helloFailure",WDLOGIN_SUCCESS:"WDLoginSuccess",WDLOGIN_FAILURE:"WDLoginFailure",OAUTH_SUCCESS:"OAuthSuccess",OAUTH_FAILURE:"OAuthFailure",GET_RESOURCE_LIST_SUCCESS:"getResourceListSuccess",GET_RESOURCE_LIST_UNHEALTHY_ERROR:"getResourceListUnhealthyError",GET_RESOURCE_LIST_UNSUPPORTED_PROTOCOL_ERROR:"getResourceListUnsupportedProtocolError",GET_RESOURCE_LIST_FAILURE:"getResourceListFailure",ALLOCATE_RESOURCE_SUCCESS:"allocateResourceSuccess",ALLOCATE_RESOURCE_FAILURE:"allocateResourceFailure",SIGNALING_SUCCESS:"ssigSuccess",SIGNALING_FAILURE:"ssigFailure",STREAMING_SUCCESS:"streamingSuccess",STREAMING_FAILURE:"streamingFailure",STREAMING_CONNECTION_SETUP_FAILURE:"streamingConnectionSetupFailure",IN_SESSION_DISCONNECTS:"inSessionDisconnects",GET_LOCAL_REGCODE_FAILURE:"getLocalRegcodeFailure",GET_LOCAL_REGCODE_SUCCESS:"getLocalRegcodeSuccess",isTimed:function(a){return a===d.MetricOperation.REGISTER||a===d.MetricOperation.HELLO||a===d.MetricOperation.WDLOGIN||a===d.MetricOperation.OAUTH||a===d.MetricOperation.GET_RESOURCE_LIST||a===d.MetricOperation.ALLOCATE_RESOURCE||a===d.MetricOperation.SIGNALING||a===d.MetricOperation.STREAMING||a===d.MetricOperation.IN_SESSION_LATENCY||a===d.MetricOperation.SESSION_LAUNCH_TIME},isAtomic:function(a){return a===d.MetricOperation.REGISTER||a===d.MetricOperation.HELLO||a===d.MetricOperation.WDLOGIN||a===d.MetricOperation.OAUTH||a===d.MetricOperation.GET_RESOURCE_LIST||a===d.MetricOperation.ALLOCATE_RESOURCE||a===d.MetricOperation.SIGNALING||a===d.MetricOperation.STREAMING},isAggregating:function(a){return a===d.MetricOperation.REGISTER||a===d.MetricOperation.HELLO||a===d.MetricOperation.WDLOGIN||a===d.MetricOperation.OAUTH||a===d.MetricOperation.GET_RESOURCE_LIST||a===d.MetricOperation.ALLOCATE_RESOURCE||a===d.MetricOperation.SIGNALING||a===d.MetricOperation.STREAMING||a===d.MetricOperation.IN_SESSION_LATENCY||a===d.MetricOperation.SESSION_LAUNCH_TIME},isPoint:function(a){return a===d.MetricOperation.REGISTER_SUCCESS||a===d.MetricOperation.REGISTER_FAILURE||a===d.MetricOperation.REGISTER_403_ERROR||a===d.MetricOperation.HELLO_SUCCESS||a===d.MetricOperation.HELLO_FAILURE||a===d.MetricOperation.WDLOGIN_SUCCESS||a===d.MetricOperation.WDLOGIN_FAILURE||a===d.MetricOperation.OAUTH_SUCCESS||a===d.MetricOperation.OAUTH_FAILURE||a===d.MetricOperation.GET_RESOURCE_LIST_SUCCESS||a===d.MetricOperation.GET_RESOURCE_LIST_UNHEALTHY_ERROR||a===d.MetricOperation.GET_RESOURCE_LIST_UNSUPPORTED_PROTOCOL_ERROR||a===d.MetricOperation.GET_RESOURCE_LIST_FAILURE||a===d.MetricOperation.ALLOCATE_RESOURCE_SUCCESS||a===d.MetricOperation.ALLOCATE_RESOURCE_FAILURE||a===d.MetricOperation.SIGNALING_SUCCESS||a===d.MetricOperation.SIGNALING_FAILURE||a===d.MetricOperation.STREAMING_SUCCESS||a===d.MetricOperation.STREAMING_FAILURE||a===d.MetricOperation.STREAMING_CONNECTION_SETUP_FAILURE||a===d.MetricOperation.IN_SESSION_DISCONNECTS||a===d.MetricOperation.IN_SESSION_DISCONNECTS||a===d.MetricOperation.GET_LOCAL_REGCODE_SUCCESS||a===d.MetricOperation.GET_LOCAL_REGCODE_FAILURE;
},isPreAuthSuccess:function(a){return a===d.MetricOperation.REGISTER||a===d.MetricOperation.HELLO||a===d.MetricOperation.WDLOGIN||a===d.MetricOperation.OAUTH||a===d.MetricOperation.REGISTER_SUCCESS||a===d.MetricOperation.REGISTER_FAILURE||a===d.MetricOperation.REGISTER_403_ERROR||a===d.MetricOperation.HELLO_SUCCESS||a===d.MetricOperation.HELLO_FAILURE||a===d.MetricOperation.WDLOGIN_SUCCESS||a===d.MetricOperation.WDLOGIN_FAILURE||a===d.MetricOperation.OAUTH_FAILURE}},MetricsConfiguration.configureNormalPipeline(2048,2048,6e5),MetricsConfiguration.configureHighPipeline(65536,2048,6e4),MetricsFactory.setDeviceTypeId("A10Q0TBTJ8PPBJ"),MetricsFactory.setDeviceSerialNumber("A10Q0TBTJ8PPBJ"),MetricsFactory.setOAuthTokenProvider(function(){return null}),MetricMetadata.directoryId="directoryId",MetricMetadata.workspaceId="workSpaceId",MetricMetadata.clientVersion="clientVersion",MetricsFactory.addMetadata(MetricMetadata.clientVersion,b.getClientVersion());var e=b.getEndpointcode(),f=e.split(".")[0].toUpperCase(),g=e.split(".")[1].toUpperCase(),h="WorkSpaces_"+f+"_GLOBAL",i="WorkSpaces_"+f+"_"+g,j="CHROMECLIENT",k=j+"_"+b.getPlatform(),l=j+"_"+b.getOrganizationName(),m="Unknown",n={};for(var o in d.MetricOperation)"string"==typeof d.MetricOperation[o]&&(n[d.MetricOperation[o]]=[MetricsFactory.createMetricEvent(1,h,j,MetricEventType.AGGREGATING,!0),MetricsFactory.createMetricEvent(2,h,k,MetricEventType.AGGREGATING,!0),MetricsFactory.createMetricEvent(3,h,l,MetricEventType.AGGREGATING,!0),MetricsFactory.createMetricEvent(4,i,j,MetricEventType.AGGREGATING,!0),MetricsFactory.createMetricEvent(5,i,k,MetricEventType.AGGREGATING,!0),MetricsFactory.createMetricEvent(6,i,l,MetricEventType.AGGREGATING,!0)]);d.updateAuthData=function(a){return d.MetricOperation.isPreAuthSuccess(a)?(MetricsFactory.addMetadata(MetricMetadata.workspaceId,m),void MetricsFactory.addMetadata(MetricMetadata.directoryId,m)):(b.getWorkspaceId()&&MetricsFactory.addMetadata(MetricMetadata.workspaceId,b.getWorkspaceId()),void(b.getDirectoryId()&&MetricsFactory.addMetadata(MetricMetadata.directoryId,b.getDirectoryId())))},d.addEventData=function(a,b){d.metricToEvent.hasOwnProperty(b)&&a.appendString("eventName",d.metricToEvent[b])},d.startOperation=function(a){if(d.MetricOperation.isTimed(a)&&d.MetricOperation.isAggregating(a))for(var b in n[a])n[a][b].startTimer(a,d.MetricOperation.isAtomic(a))},d.submitOperation=function(b,e){if(d.updateAuthData(b),d.MetricOperation.isTimed(b)&&d.MetricOperation.isAggregating(b))for(var f in n[b])if(null!==n[b][f].stopTimer(b));else{if(null===e||e!=parseInt(e))return void a.info(c,"submitOperation failed: "+b);n[b][f].addTimer(b,e,1)}if(d.MetricOperation.isPoint(b))for(var g in n[b])n[b][g].incrementCounter(b,1);for(var h in n[b])d.addEventData(n[b][h],b),MetricsFactory.recordMetricEvent(n[b][h],MetricPriority.HIGH)}}]);var workSpacesApp=angular.module("workSpacesApp"),TAG="registration-service.js";workSpacesApp.service("registrationService",["logger","$q","metricsService","storageService",function(a,b,c,d){var e=this;e.ERROR_FORMAT="ERR_BAD_FORMAT",e.ERROR_PREFIX="ERR_BAD_PREFIX",e.register=function(c){if(-1==c.indexOf("+"))return a.error(TAG,"invalid registration code format: "+c),b.reject({"error-code":e.ERROR_FORMAT,data:c});d.save("registrationCode",c),prefix=c.split("+")[0];var f={sltest:"test.iad",slbeta:"beta.iad",frbeta:"fips.beta.iad",sliad:"prod.iad",friad:"fips.prod.iad",wsgamma:"gamma.pdx",frgamma:"fips.gamma.pdx",wspdx:"prod.pdx",frpdx:"fips.prod.pdx",wsdub:"prod.dub",wssyd:"prod.syd",wsnrt:"prod.nrt",wssin:"prod.sin",wsfra:"prod.fra",wslhr:"prod.lhr",wsyul:"prod.yul",wsgru:"prod.gru",wsicn:"prod.icn",wspdt:"prod.pdt",frpdt:"fips.prod.pdt"},g=f[prefix.toLowerCase()];return g?(d.save("endpointcode",g),b.resolve({registrationCode:c})):(a.error(TAG,"invalid registration code prefix: "+c),b.reject({"error-code":e.ERROR_PREFIX,data:c}))},e.getRegistrationCode=function(){return d.getRegistrationCode()},e.getOrganizationName=function(){return d.getOrganizationName()},e.getEndpointcode=function(){return d.getEndpointcode()}}]);var workSpacesApp=angular.module("workSpacesApp");workSpacesApp.service("storageService",[function(){var a=this;a.save=function(a,b){localStorage.setItem(a,b)},a.getLogItem=function(a){return sessionStorage.getItem(a)},a.getRegistrationCode=function(){return localStorage.getItem("registrationCode")};var b=function(){var a=localStorage.getItem("registrationFile");return a?JSON.parse(a):{organizationName:"undefined",endpointcode:"undefined.undefined"}};a.getOrganizationName=function(){var a=localStorage.getItem("organizationName");return a||(a=b().organizationName),a},a.getEndpointcode=function(){var a=localStorage.getItem("endpointcode");return a||(a=b().endpointcode),a},a.getPlatform=function(){var a="Unknown";return navigator.userAgent.match(/edge\/\d+/i)?a=navigator.userAgent.match(/edge\/\d+/i)[0]:navigator.userAgent.match(/firefox\/\d+/i)?a=navigator.userAgent.match(/firefox\/\d+/i)[0]:navigator.userAgent.match(/opr\/\d+/i)?a=navigator.userAgent.match(/opr\/\d+/i)[0]:navigator.userAgent.match(/chrome\/\d+/i)?a=navigator.userAgent.match(/chrome\/\d+/i)[0]:navigator.userAgent.match(/msie \d+/i)?a=navigator.userAgent.match(/msie \d+/i)[0]:navigator.userAgent.match(/safari\/\d+/i)?a=navigator.userAgent.match(/safari\/\d+/i)[0]:console.error("Unrecognised user agent: "+navigator.userAgent),a},a.getOS=function(){return navigator.platform},a.getUserAgent=function(){return navigator.userAgent},a.getWorkspaceId=function(){return localStorage.getItem("workspaceId")},a.getDirectoryId=function(){return localStorage.getItem("directoryId")},a.getClientVersion=function(){return"2.5.2"}}]);var workSpacesApp=angular.module("workSpacesApp"),TAG="streaming-service.js";workSpacesApp.service("streamingService",["logger","$q","$window","metricsService",function(a,b,c,d){function e(a,b,c,d,e,f){function g(a,b){e.verbose(D,a,"left",b.left,"top",b.top,"width",b.width,"height",b.height)}function h(){var a=d;if(0===a.videoWidth||0===a.videoHeight)return e.verbose(D,"The videosink has 0 width or height. The frame is probably not ready yet. Mouse input ignored."),null;E&&e.verbose(D,"getVideoClientRect():","video.videoWidth",a.videoWidth,"video.videoHeight",a.videoHeight);var b=a.videoWidth/a.videoHeight,c=a.getBoundingClientRect(),f=c.width/c.height,h={left:c.left,top:c.top,width:c.width,height:c.height};return E&&g("videoRect (bounds)",h),f>b?(h.width=c.height*b,h.left+=(c.width-h.width)/2):(h.height=c.width/b,h.top+=(c.height-h.height)/2),E&&g("videoRect (trimmed)",h),h}function i(){C.hasOwnProperty("onSendFailed")?C.onSendFailed():e.warn(D,"WorkSpacesInputAdapter.onSendFailed() callback function was not defined.")}function j(a,b){C.hasOwnProperty("onResolutionChange")?C.onResolutionChange(a,b):e.warn(D,"WorkSpacesInputAdapter.onResolutionChange(newWidth={0}, newHeight={1}) callback function was not defined.",a,b)}function k(a,c,f,g){var j=h();if(j){var k={input_type:"RAW_MOUSE",time:Math.floor(window.performance.now()),raw_mouse:{mouse_id:0,flags:W.MOUSE_MOVE_ABSOLUTE,button_flags:f,buttons:0,button_data:g||0}};(0===V.width||0===V.height)&&(e.warn(D,"Have not received the serverResolution, mouse coordinates offset not computed.  The mouse coordinates is probably off if the video element is resized."),V.width=d.videoWidth,V.height=d.videoHeight,V.aspect=V.width/V.height);var l=(V.width-d.videoWidth)/2,m=(V.height-d.videoHeight)/2;E&&e.verbose(D,"sendMouseEvent(): offsetX",l,"offsetY",m),k.raw_mouse.last_x=(a-j.left)*d.videoWidth/j.width+l+.5|0,k.raw_mouse.last_y=(c-j.top)*d.videoHeight/j.height+m+.5|0,(E||F)&&e.verbose(D,"sendMouseEvent():","last_x",k.raw_mouse.last_x,"last_y",k.raw_mouse.last_y,"flags",k.raw_mouse.flags,"button_flags",k.raw_mouse.button_flags,"button_data",k.raw_mouse.button_data,"x",a,"y",c);try{b.send(k)}catch(n){e.verbose(D,"sendMouseEvent(): inputSink.send() failed: {0}\n{1}",n.message,n.stack),i()}}}function l(a,c,d){if(d||(d=0),a===R&&(a=P),a!==P&&d!==Q||!N){var f={input_type:"RAW_KEYBOARD",time:Math.floor(window.performance.now()),raw_keyboard:{is_key_down:c,virtual_key:a,scan_code:d}};try{b.send(f),a!==P||N||c||m()}catch(g){e.verbose(D,"sendMouseEvent(): inputSink.send() failed: {0}\n{1}",g.message,g.stack),i()}}}function m(){var a={input_type:"RAW_KEYBOARD",time:Math.floor(window.performance.now()),raw_keyboard:{is_key_down:!1,virtual_key:-1,scan_code:-1}};try{b.send(a)}catch(c){i()}}function n(a){!a.which&&a.button&&(1&a.button?a.which=1:4&a.button?a.which=2:2&a.button&&(a.which=3))}function o(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.cancel=!0,a.returnValue=!1,!1}function p(a){return a=a||window.event,n(a),k(a.clientX,a.clientY,0),E&&e.verbose(D,"onmousemove",a),o(a)}function q(a){a=a||window.event,n(a);var b=h();if(a.clientX<b.left)return o(a);if(a.clientX>b.left+b.width)return o(a);if(a.clientY<b.top)return o(a);if(a.clientY>b.top+b.height)return o(a);switch(a.which){default:case 1:k(a.clientX,a.clientY,W.RI_MOUSE_LEFT_BUTTON_DOWN);break;case 2:k(a.clientX,a.clientY,W.RI_MOUSE_MIDDLE_BUTTON_DOWN);break;case 3:k(a.clientX,a.clientY,W.RI_MOUSE_RIGHT_BUTTON_DOWN)}return E&&e.verbose(D,"onmousedown",a),o(a)}function r(a){switch(a=a||window.event,n(a),a.which){default:case 1:k(a.clientX,a.clientY,W.RI_MOUSE_LEFT_BUTTON_UP);break;case 2:k(a.clientX,a.clientY,W.RI_MOUSE_MIDDLE_BUTTON_UP);break;case 3:k(a.clientX,a.clientY,W.RI_MOUSE_RIGHT_BUTTON_UP)}return E&&e.verbose(D,"onmouseup",a),o(a)}function s(a){return a=a||window.event,n(a),E&&e.verbose(D,"onmouseout",a),o(a)}function t(a){var b=-Math.round(a.deltaY);return J.firefox&&1===a.deltaMode&&(b*=W.WHEEL_DELTA/3),F&&e.verbose("DeltaY: "+a.deltaY+" amountToScroll: "+b),k(a.clientX,a.clientY,W.RI_MOUSE_WHEEL,b),o(a)}function u(a){return a=a||window.event,o(a)}function v(a){var b=a.keyCode;switch(a.code){case"Minus":b=189;break;case"Equal":b=187;break;case"Semicolon":b=186}return b}function w(a){var b=0;switch(a.code){case"Escape":b=1;break;case"F1":b=59;break;case"F2":b=60;break;case"F3":b=61;break;case"F4":b=62;break;case"F5":b=63;break;case"F6":b=64;break;case"F7":b=65;break;case"F8":b=66;break;case"F9":b=67;break;case"F10":b=68;break;case"F11":b=87;break;case"F12":b=88;break;case"F13":case"PrintScreen":b=57399;break;case"ScrollLock":b=70;break;case"Pause":b=69;break;case"Backquote":b=41;break;case"Digit1":b=2;break;case"Digit2":b=3;break;case"Digit3":b=4;break;case"Digit4":b=5;break;case"Digit5":b=6;break;case"Digit6":b=7;break;case"Digit7":b=8;break;case"Digit8":b=9;break;case"Digit9":b=10;break;case"Digit0":b=11;break;case"Minus":b=12;break;case"Equal":b=13;break;case"Backspace":b=14;break;case"Tab":b=15;break;case"KeyQ":b=16;break;case"KeyW":b=17;break;case"KeyE":b=18;break;case"KeyR":b=19;break;case"KeyT":b=20;break;case"KeyY":b=21;break;case"KeyU":b=22;break;case"KeyI":b=23;break;case"KeyO":b=24;break;case"KeyP":b=25;break;case"BracketLeft":b=26;break;case"BracketRight":b=27;break;case"Enter":b=28;break;case"Backslash":b=43;break;case"CapsLock":b=58;break;case"KeyA":b=30;break;case"KeyS":b=31;break;case"KeyD":b=32;break;case"KeyF":b=33;break;case"KeyG":b=34;break;case"KeyH":b=35;break;case"KeyJ":b=36;break;case"KeyK":b=37;break;case"KeyL":b=38;break;case"Semicolon":b=39;break;case"Enter":b=28;break;case"ShiftLeft":b=42;break;case"KeyZ":b=44;break;case"KeyX":b=45;break;case"KeyC":b=46;break;case"KeyV":b=47;break;case"KeyB":b=48;break;case"KeyN":b=49;break;case"KeyM":b=50;break;case"Comma":b=51;break;case"Period":b=52;break;case"Slash":b=53;break;case"ShiftRight":b=54;break;case"ControlLeft":b=29;break;case"MetaLeft":case"OSLeft":b=57435;break;case"AltLeft":b=56;break;case"Space":b=57;break;case"AltRight":b=57400;break;case"MetaRight":case"OSRight":b=57436;break;case"ContextMenu":b=57437;break;case"ControlRight":b=57373;break;case"ArrowUp":b=57416;break;case"ArrowLeft":b=57419;break;case"ArrowRight":b=57421;break;case"ArrowDown":b=57424;break;case"NumLock":b=57413;break;case"NumpadDivide":b=57397;break;case"NumpadMultiply":b=55;break;case"NumpadSubtract":b=74;break;case"NumpadAdd":b=78;break;case"NumpadEnter":b=57372;break;case"Numpad7":b=71;break;case"Numpad8":b=72;break;case"Numpad9":b=73;break;case"Numpad4":b=75;break;case"Numpad5":b=76;break;case"Numpad6":b=77;break;case"Numpad1":b=79;break;case"Numpad2":b=80;break;case"Numpad3":b=81;break;case"Numpad0":b=82;break;case"NumpadDecimal":b=83;break;case"Insert":b=57426;break;case"Home":b=57415;break;case"PageUp":b=57417;break;case"PageDown":b=57425;break;case"Delete":b=57427;break;case"End":b=57423;break;case"Quote":b=40;break;case"IntlYen":b=125;break;case"IntlRo":b=115}return b}function x(a){a=a||window.event,G&&e.verbose(D,"keydown - key:"+a.key+" code:"+a.code);var b=O===L?v(a):0,c=O===M?w(a):0;return J.chrome&&K&&(a.metaKey&&a.shiftKey&&(C.shiftAndMetaKeysPressed=!0),a.metaKey&&a.shiftKey||!C.shiftAndMetaKeysPressed||(m(),C.shiftAndMetaKeysPressed=!1)),K&&(a.metaKey&&"Meta"!==a.key?(C.keyWithMetaSaved=!0,C.keyWithMetaKeycode=b,C.keyWithMetaScancode=c):C.keyWithMetaSaved=!1),a.code===S&&K?(l(b,!0,c),l(b,!1,c)):a.code===T||a.code===U?(l(b,!0,c),l(b,!1,c)):l(b,!0,c),o(a)}function y(a){a=a||window.event,G&&e.verbose(D,"keyup - key:"+a.key+" code:"+a.code);var b=O===L?v(a):0,c=O===M?w(a):0;return J.chrome&&K&&(a.metaKey||a.shiftKey)&&(C.shiftAndMetaKeysPressed=!1),K&&"Meta"===a.key&&C.keyWithMetaSaved&&l(C.keyWithMetaKeycode,!1,C.keyWithMetaScancode),a.code===S&&K?(l(b,!0,c),l(b,!1,c)):a.code===T||a.code===U?(l(b,!0,c),l(b,!1,c)):l(b,!1,c),o(a)}function z(a){return a=a||window.event,m(),G&&e.info(D,"blur",a),o(a)}function A(a){return a=a||window.event,m(),G&&e.info(D,"focus",a),o(a)}function B(b){b=b||window.event;var c=window.innerWidth||a.documentElement.clientWidth||a.body.clientWidth,d=window.innerHeight||a.documentElement.clientHeight||a.body.clientHeight;return H&&(e.verbose(D,"resized",b),e.verbose(D,"Window height: "+d+" width: "+c)),o(b)}var C=this,D="WorkSpacesInputAdapter",E=!1,F=!1,G=!1,H=!1,I=!1,J=bowser,K=navigator.platform.indexOf("Mac")>=0,L="keycode",M="scancode",N=!0,O=L,P=91,Q=57435,R=224,S="CapsLock",T="PrintScreen",U="F13",V={width:0,height:0,aspect:0},W={MOUSE_MOVE_ABSOLUTE:1,WHEEL_DELTA:120,RI_MOUSE_LEFT_BUTTON_DOWN:1,RI_MOUSE_LEFT_BUTTON_UP:2,RI_MOUSE_MIDDLE_BUTTON_DOWN:16,RI_MOUSE_MIDDLE_BUTTON_UP:32,RI_MOUSE_RIGHT_BUTTON_DOWN:4,RI_MOUSE_RIGHT_BUTTON_UP:8,RI_MOUSE_WHEEL:1024};if(!a)throw new Error("WorkSpacesInputAdapter: no inputSource given");if(!b)throw new Error("WorkSpacesInputAdapter: no inputSink given");if(!c)throw new Error("WorkSpacesInputAdapter: no videoSource given");if(!d)throw new Error("WorkSpacesInputAdapter: no videoSink given");f||e.warn(D,"No keyboardInputSource was specified, defaulting keyboard events to inputSource."),c.onResolutionChange=function(a,b){I&&e.verbose(D,"serverResolutionChange():","newWidth",a,"newHeight",b),V.width=a,V.height=b,V.aspect=a/b,j(a,b)},this.bindEvents=function(){e.info(D,"bindEvents"),a.addEventListener("mousemove",p),a.addEventListener("mousedown",q),a.addEventListener("mouseup",r),a.addEventListener("mouseout",s),a.addEventListener("wheel",t),a.addEventListener("contextmenu",u),f?(f.addEventListener("keydown",x),f.addEventListener("keyup",y)):(a.addEventListener("keydown",x),a.addEventListener("keyup",y)),window.addEventListener("blur",z),window.addEventListener("focus",A),window.addEventListener("resize",B)},this.unbindEvents=function(){e.info(D,"UN-bindEvents"),a.removeEventListener("mousemove",p),a.removeEventListener("mousedown",q),a.removeEventListener("mouseup",r),a.removeEventListener("mouseout",s),a.removeEventListener("wheel",t),a.removeEventListener("contextmenu",u),f?(f.removeEventListener("keydown",x),f.removeEventListener("keyup",y)):(a.removeEventListener("keydown",x),a.removeEventListener("keyup",y)),window.removeEventListener("blur",z),window.removeEventListener("focus",A),window.removeEventListener("resize",B)},this.clearModifiers=function(){e.info(D,"clearModifiers"),m()},this.sendKey=function(a,b){e.info(D,"sendKey"),l(a,b,0)},this.setIgnoreWinKey=function(a){N=a},this.setKeyboardType=function(a){O=a}}var f=this,g="version",h="peerConnectionConfig",i="peerName",j="keyboardType",k="primaryMonitor-mediaStream",l=2,m=[1,2],n=17,o=18,p=46;f.ERR_SIG_TIMEOUT="ERR_SIG_TIMEOUT",f.ERR_SIG_FAILED="ERR_SIG_FAILED",f.ERR_PC_FAILED="ERR_PC_FAILED",f.ERR_PC_SETUP_FAILED="ERR_PC_SETUP_FAILED",f.ERR_CAPEX_BAD_MSG="ERR_CAPEX_BAD_MSG",f.ERR_CAPEX_NO_VER="ERR_CAPEX_NO_VER",f.ERR_CAPEX_BAD_VER="ERR_CAPEX_BAD_VER",f.ERR_CAPEX_NO_CONFIG="ERR_CAPEX_NO_CONFIG",f.ERR_CAPEX_APPLY_FAILED="ERR_CAPEX_APPLY_FAILED",f.ERR_CAPEX_BAD_PEER="ERR_CAPEX_BAD_PEER",f.ERR_CAPEX_SELECT_FAILED="ERR_CAPEX_SELECT_FAILED",f.ERR_CAPEX_VERIFY_FAILED="ERR_CAPEX_VERIFY_FAILED",f.ERR_PC_CREATE_FAILED="ERR_PC_CREATE_FAILED",f.ERR_SIG_CREATE_FAILED="ERR_SIG_CREATE_FAILED",f.ERR_SIG_START_FAILED="ERR_SIG_START_FAILED",f.ERR_NO_BEST_RESOLUTION_FOUND="ERR_NO_BEST_RESOLUTION_FOUND",f.user_initiated_disconnect=!1;var q={kStateNew:0,kStatePeerSignalerConnecting:1,kStateAwaitingHostCapabilities:2,kStateAwaitingSelectedHostConfiguration:3,kStateAwaitingAppliedHostConfiguration:4,kStatePeerConnectionConnecting:5,kStatePeerConnectionConnected:6,kStateDisconnecting:7,kStateStopped:8,toName:function(a){for(var b in this)if(this[b]===a)return b;return"ERROR: unknown States value: "+a}};f.state=q.kStateNew,f.setState=function(b){f.state===b?a.info(TAG,"State unchanged.  Ignored."):(a.info(TAG,"setState. from: "+q.toName(f.state)+", to:"+q.toName(b)),f.state=b)},f.connect=function(c){f.connection_params=c;try{f.setupLogging()}catch(d){a.error(TAG,"Error setting up logging: "+d)}try{f.configurePeerSignaler(c.creds)}catch(d){return a.error(TAG,"Error creating peer signaler: "+d),b.reject({"error-code":f.ERR_SIG_CREATE_FAILED,response:d})}try{f.configurePeerConnection()}catch(d){return a.error(TAG,"Error creating peer connection: "+d),b.reject({"error-code":f.ERR_PC_CREATE_FAILED,response:d})}try{f.startSignaling()}catch(d){return a.error(TAG,"Error starting signaling: "+d),b.reject({"error-code":f.ERR_SIG_START_FAILED,response:d})}return b(function(a,b){f.resolve=a,f.reject=b})},f.disconnect=function(b){a.info(TAG,"Disconnecting.  User initiated: "+b),f.user_initiated_disconnect=b,f.inputAdapter&&(f.inputAdapter.unbindEvents(),f.inputAdapter=null),f.peerSignaler&&(f.peerSignaler.disconnect(),f.peerSignaler=null),f.peerConnection&&(f.peerConnection.disconnect(),f.peerConnection=null),f.connection_params.videoElement&&(f.connection_params.videoElement.pause(),f.connection_params.videoElement.src=""),f.stxhd=void 0,f.connected=!1},f.sendCtrlAltDel=function(){a.info(TAG,"Sending ctrl+alt+del");var b=!0;f.inputAdapter.sendKey(n,b),f.inputAdapter.sendKey(o,b),f.inputAdapter.sendKey(p,b),f.inputAdapter.sendKey(p,!b),f.inputAdapter.sendKey(o,!b),f.inputAdapter.sendKey(n,!b)},f.exitFullScreen=function(){document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen()},f.enterFullScreen=function(){var a=f.connection_params.inputElement;a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()},f.isFullScreen=function(){var a=document.webkitFullscreenElement||document.mozFullScreenElement;return a},f.changeResolution=function(){return f.config&&f.peerConnected?(f.selectHostConfiguration(f.config),f.peerConnection.flushMessages(),b(function(a,b){f.resolve=a,f.reject=b})):b.reject({"error-code":f.ERR_RES_CHANGE_FAILED})},f.setupLogging=function(){f.stxhd=new Stxhd;var b=f.stxhd.getLogger();b.setLevel(a.VERBOSE),b.onLog=a.log,a.info(TAG,"browser info: "+JSON.stringify(f.stxhd.getBrowserStats()))},f.configurePeerSignaler=function(a){f.peerSignaler=f.stxhd.createPeerSignaler(a),f.peerSignaler.onConnecting=f.peerSignalerOnConnecting,f.peerSignaler.onFailed=f.peerSignalerOnFailed,f.peerSignaler.onConnected=f.peerSignalerOnConnected,f.peerSignaler.onPeerDisconnected=f.peerSignalerOnPeerDisconnected,f.peerSignaler.onUtf8Message=f.peerSignalerOnUtf8Message,f.peerSignaler.onBinaryMessage=f.peerSignalerOnBinaryMessage,f.peerSignaler.onDisconnected=f.peerSignalerOnDisconnected},f.configurePeerConnection=function(){f.peerConnection=f.stxhd.createPeerConnection(f.peerSignaler),f.peerConnection.onSignalingConnecting=f.peerConnectionOnSignalingConnecting,f.peerConnection.onSignalingConnected=f.peerConnectionOnSignalingConnected,f.peerConnection.onConnected=f.peerConnectionOnConnected,f.peerConnection.onDisconnecting=f.peerConnectionOnDisconnecting,f.peerConnection.onDisconnected=f.peerConnectionOnDisconnected,f.peerConnection.onFailed=f.peerConnectionOnFailed,f.peerConnection.onUtf8Message=f.peerConnectionOnUtf8Message,f.peerConnection.onBinaryMessage=f.peerConnectionOnBinaryMessage,f.peerConnection.onAddRemoteMediaStream=f.peerConnectionOnAddRemoteMediaStream,f.peerConnection.onAddDataChannel=f.peerConnectionOnAddDataChannel,f.localInputStream=f.peerConnection.createLocalInputStream("TestInputStream")},f.startSignaling=function(){f.peerConnected=!1,f.setState(q.kStatePeerSignalerConnecting),d.startOperation(d.MetricOperation.SIGNALING),f.peerSignaler.connect(),f.peerSignaler.connectTimeout=setTimeout(f.peerSignalerOnTimeout,18e4)},f.peerSignalerOnConnecting=function(){a.info(TAG,"Connecting PeerSignaler...")},f.peerSignalerOnFailed=function(b){a.error(TAG,"Failed to connect to PeerSignaler with reason: "+b),d.submitOperation(d.MetricOperation.SIGNALING_FAILURE),f.reject({"error-code":f.ERR_SIG_FAILED,response:b}),f.peerSignaler.disconnect()},f.peerSignalerOnConnected=function(){a.info(TAG,"peerSignaler.onConnected()."),clearTimeout(f.peerSignaler.connectTimeout)},f.peerSignalerOnPeerDisconnected=function(b){a.info(TAG,"PeerSignaler's peer disconnected with reason: "+b)},f.peerSignalerOnUtf8Message=function(b){a.info(TAG,"Peer Signaler onUtf8Message(): "+b)},f.peerSignalerOnBinaryMessage=function(b){a.info(TAG,"Peer Signaler onBinaryMessage() with length: "+b.byteLength)},f.peerSignalerOnDisconnected=function(b,c){a.info(TAG,"Peer Signaler onDisconnected() with reason: "+b+", description: "+c),d.submitOperation(d.MetricOperation.IN_SESSION_DISCONNECTS),localStorage.removeItem(d.STREAMING_ON),f.peerConnectionOnFailed(b)},f.peerSignalerOnTimeout=function(){a.error(TAG,"Timed out while waiting for peerSignaler to connect."),d.submitOperation(d.MetricOperation.SIGNALING_FAILURE),f.peerSignaler.disconnect(),f.reject({"error-code":f.ERR_SIG_TIMEOUT,response:null})},f.bindInputs=function(){return f.peerConnected?f.remoteMediaStream?(f.inputAdapter||(a.info(TAG,"Creating inputAdapter"),f.inputAdapter=new e(f.connection_params.inputElement,f.localInputStream,f.remoteMediaStream,f.connection_params.videoElement,a),f.inputAdapter.setIgnoreWinKey(!1),f.keyboardType&&f.inputAdapter.setKeyboardType(f.keyboardType)),a.info(TAG,"Binding inputs"),void f.inputAdapter.bindEvents()):void a.info(TAG,"remoteMediaStream is not ready yet, cannot bind input events"):void a.info(TAG,"!peerConnected, not yet ready for binding input")},f.peerConnectionOnSignalingConnecting=function(){a.info(TAG,"peerConnectionOnSignalingConnecting")},f.peerConnectionOnSignalingConnected=function(){a.info(TAG,"peerConnectionOnSignalingConnected"),d.submitOperation(d.MetricOperation.SIGNALING),d.submitOperation(d.MetricOperation.SIGNALING_SUCCESS),f.streamingSubmitted=!1,d.startOperation(d.MetricOperation.STREAMING),f.setState(q.kStateAwaitingHostCapabilities)},f.peerConnectionOnConnected=function(){if(a.info(TAG,"received peerConnection.onConnected"),f.peerConnected)throw a.error(TAG,"peerConnection.onConnected was already called"),new Error("peerConnection.onConnected was already called.");f.peerConnected=!0,f.bindInputs()},f.peerConnectionOnDisconnecting=function(b){a.info(TAG,"peerConnectionOnDisconnecting reason: "+b),f.setState(q.kStateDisconnecting),f.disconnect()},f.peerConnectionOnDisconnected=function(b){a.log(a.level.INFO,TAG,"received peerConnection.onDisconnected with reason: "+b),f.setState(q.kStateDisconnecting),f.disconnect()},f.peerConnectionOnAddRemoteMediaStream=function(b){a.log(a.level.INFO,TAG,"received peerConnection.onAddRemoteMediaStream"),f.remoteMediaStream=b;var c=b.getWebRtcMediaStream();try{f.connection_params.videoElement.srcObject=c}catch(e){f.connection_params.videoElement.src=window.URL.createObjectURL(c)}var g=f.connection_params.videoElement.play();void 0!==g&&g.then(function(b){a.log(a.level.INFO,TAG,"Autoplay started!")})["catch"](function(b){a.log(a.level.INFO,TAG,"Autoplay was prevented!"),$("#stx-play").show()}),f.bindInputs(),f.connection_params.videoElement.onloadeddata=function(){a.info(TAG,"Received first frame of data."),d.submitOperation(d.MetricOperation.SESSION_LAUNCH_TIME),localStorage.setItem(d.STREAMING_ON,"1"),f.connected=!0};var h=f.peerConnection.originalWebRTCPeerConnection;f.getStats(h)},f.getStats=function(b){for(var c=3e4,e=function(a){a.forEach(function(a){if(a.hasOwnProperty("currentRoundTripTime")){var b=1e3*a.currentRoundTripTime;d.submitOperation(d.MetricOperation.IN_SESSION_LATENCY,b)}})},g=b.getReceivers(),h=null,i=0;i<g.length;i++)if("video"===g[i].track.kind){h=g[i];break}h?h.getStats().then(e):a.info(TAG,"Video receiver not found."),setTimeout(function(){f.getStats(b)},c)},f.peerConnectionOnAddDataChannel=function(b){b.onMessage=function(b){a.log(a.level.INFO,TAG,"(remote) stxhdDataChannel.onMessage("+JSON.stringify(b)+")")}},f.peerConnectionOnFailed=function(b){if(a.log(a.level.INFO,TAG,"peerConnectionOnFailed with reason: "+b),f.setState(q.kStateDisconnecting),!f.user_initiated_disconnect){var c={};f.connected?(d.submitOperation(d.MetricOperation.STREAMING_FAILURE),c={"error-code":f.ERR_PC_FAILED,response:b},a.error(TAG,"Lost peer connection after successful connection."),f.reject(c),f.connection_params.onDisconnect(c)):(d.submitOperation(d.MetricOperation.STREAMING_CONNECTION_SETUP_FAILURE),c={"error-code":f.ERR_PC_SETUP_FAILED,response:b},a.error(TAG,"Lost peer connection during connection setup."),f.reject(c),f.connection_params.onDisconnect(c)),f.disconnect()}},f.peerConnectionOnUtf8Message=function(b){a.info(TAG,"peerConnectionOnUtf8Message: "+b);var c=null;try{c=JSON.parse(b)}catch(e){a.error(TAG,"Error parsing capabilities JSON message: "+e),d.submitOperation(d.MetricOperation.STREAMING_FAILURE),f.reject({"error-code":f.ERR_CAPEX_BAD_MSG,response:b})}c.hasOwnProperty(g)||(a.error(TAG,"message has no version: "+b),d.submitOperation(d.MetricOperation.STREAMING_FAILURE),f.reject({"error-code":f.ERR_CAPEX_NO_VER,response:b}));var k=c[g];m.includes(k)||(a.error(TAG,"Unexpected capabilities exchange version. Expected on of: "+m+".  Received: "+k),f.disconnect(),d.submitOperation(d.MetricOperation.STREAMING_FAILURE),f.reject({"error-code":f.ERR_CAPEX_BAD_VER,response:k}));var l=c[h];l||(a.warn(TAG,"Received message of unknown type."),d.submitOperation(d.MetricOperation.STREAMING_FAILURE),f.reject({"error-code":f.ERR_CAPEX_NO_CONFIG,response:l}));var n=l[i];switch("host"!==n&&(a.warn(TAG,"received unknown peerName: "+n),d.submitOperation(d.MetricOperation.STREAMING_FAILURE),f.reject({"error-code":f.ERR_CAPEX_BAD_PEER,response:n})),2===k&&(f.keyboardType=l[j],a.info(TAG,"Received keyboardType: "+f.keyboardType)),f.state){case q.kStateNew:case q.kStatePeerSignalerConnecting:a.warn(TAG,"onPeerConnectionConfig() while in unexpected state: "+q.toName(state));break;case q.kStateAwaitingHostCapabilities:try{f.selectHostConfiguration(l),f.setState(q.kStateAwaitingAppliedHostConfiguration),f.peerConnectionConnect()}catch(e){a.error(TAG,"onPeerConnectionConfig(): kStateAwaitingHostCapabilities handler failed: "+e.message),f.disconnect(),d.submitOperation(d.MetricOperation.STREAMING_FAILURE),f.reject({"error-code":f.ERR_CAPEX_SELECT_FAILED,response:e})}break;case q.kStateAwaitingSelectedHostConfiguration:try{f.applySelectedHostConfiguration(l),f.setState(q.kStatePeerConnectionConnecting),f.peerConnectionConnect()}catch(e){a.error(TAG,"onPeerConnectionConfig(): kStateAwaitingSelectedHostConfiguration handler failed: "+e.message),f.disconnect(),d.submitOperation(d.MetricOperation.STREAMING_FAILURE),f.reject({"error-code":f.ERR_CAPEX_APPLY_FAILED,response:e})}break;case q.kStateAwaitingAppliedHostConfiguration:try{f.verifyAppliedHostConfiguration(l),f.setState(q.kStatePeerConnectionConnecting)}catch(e){a.error(TAG,"onPeerConnectionConfig(): kStateAwaitingAppliedHostConfiguration handler failed: "+e.message),f.disconnect(),d.submitOperation(d.MetricOperation.STREAMING_FAILURE),f.reject({"error-code":f.ERR_CAPEX_VERIFY_FAILED,response:e})}break;case q.kStatePeerConnectionConnecting:case q.kStatePeerConnectionConnected:f.verifyAppliedHostConfiguration(l);break;case q.kStateDisconnecting:case q.kStateStopped:a.warn(TAG,"onPeerConnectionConfig() while disconnecting or stopped.  Ignored.");break;default:a.warn(TAG,"onPeerConnectionConfig() called in unhandled state  "+q.toName(state))}},f.peerConnectionConnect=function(){f.peerConnection.connect(!0)},f.getAvailableWorkArea=function(){var b={width:c.innerWidth,height:c.innerHeight};return f.isFullScreen()&&(b.width=$(window).width(),b.height=$(window).height()),a.info(TAG,"available work area: "+JSON.stringify(b)+", fullScreen: "+f.isFullScreen()),b},f.peerConnectionQueueMessage=function(b){var c=JSON.stringify(b);a.info(TAG,"Queueing peer connection message: "+c),f.peerConnection.queueUtf8Message(c)},f.selectHostConfiguration=function(b){a.info(TAG,"selectHostConfiguration with config: "+JSON.stringify(b)),f.config=b;var c=b.videoSources.displays.primary.modes;a.info(TAG,"modes before sorting: "+JSON.stringify(c)),c.sort(function(a,b){return a.width<b.width?-1:a.width>b.width?1:a.height<b.height?-1:a.height>b.height?1:0}),f.isFullScreen()||(a.info(TAG,"Filtering out non-multiple of 8 resolutions."),c=c.filter(function(a){return a.height%8===0})),a.info(TAG,"sorted/filtered modes are now: "+JSON.stringify(c));for(var d,e=b.mediaStreams[k].config.currentMode,g=f.getAvailableWorkArea(),h=[],i=0,j=0;j<c.length;j++)c[j].width<=g.width&&(c[j].width>i&&c[j].height<=g.height&&(i=c[j].width,h=[]),c[j].height<=g.height&&h.push(c[j]));a.info(TAG,"Candidate resolutions: "+JSON.stringify(h));for(var m=0;m<h.length;m++)d||(d=h[m]),h[m].height<=g.height&&h[m].height>d.height&&(d=h[m]);d&&g.width>=d.width&&g.height>=d.height?(e.width=d.width,e.height=d.height,a.info(TAG,"Found a good resolution that matches the available work area: "+JSON.stringify(e))):a.error(TAG,"Could not find a resolution that will fit the available work area.");var n={version:l,peerConnectionConfig:b};f.peerConnectionQueueMessage(n)},f.applySelectedHostConfiguration=function(b){a.info(TAG,"applySelectedHostConfiguration()");var c={version:l,peerConnectionConfig:b};f.peerConnectionQueueMessage(c)},f.verifyAppliedHostConfiguration=function(b){a.info(TAG,"verifyAppliedHostConfiguration()"),f.config=b;var c=b.mediaStreams[k].config.currentMode;a.info(TAG,"targetResolution: "+JSON.stringify(c)),f.resolve&&(f.streamingSubmitted||(d.submitOperation(d.MetricOperation.STREAMING),d.submitOperation(d.MetricOperation.STREAMING_SUCCESS),f.streamingSubmitted=!0),f.resolve(c))},f.peerConnectionOnBinaryMessage=function(b){a.info(TAG,"received peerConnectionOnBinaryMessage with length: "+b.byteLength)},f.videoMouseMove=function(){f.connection_params.videoElement.className="stx-video-mouse-move",f.videoMouseMoveTimeout&&clearTimeout(f.videoMouseMoveTimeout),f.videoMouseMoveTimeout=setTimeout(function(){f.connection_params.videoElement.className="stx-video"},500)}}]);var workSpacesControllers=angular.module("workSpacesControllers",[]),TAG="workspaces-controllers.js",WEB_CLIENT_URL="https://"+window.location.hostname+"/webclient",errorHandlerUrl=null;Number.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},workSpacesControllers.controller("MainController",["$scope","$location","$window","$state","$timeout","logger","errorHandlerService","registrationService","connectionManagerService","streamingService","metricsService","storageService",function(a,b,c,d,e,f,g,h,i,j,k,l){
var m=localStorage.getItem(k.STREAMING_ON);m&&(f.info(TAG,"Unexpected streaming termination detected"),localStorage.removeItem(k.STREAMING_ON),k.submitOperation(k.MetricOperation.IN_SESSION_DISCONNECTS)),a.CLIENT_VERSION=l.getClientVersion(),a.selectedLanguage=$.i18n.getLanguage(),$.i18n.setLanguage(a.selectedLanguage),a.updateSelectedLanguage=function(a){$.i18n.setLanguage(a)},e(function(){$.i18n.setLanguage(a.selectedLanguage)}),a.isPlatformSupported=function(a){var b=-1!=a.indexOf("Chrome"),c=-1!=a.indexOf("Firefox"),d=!1;if(c){var e=a.split("/");if(e.length>1){var g=e[1];try{g=parseInt(g),d=g>=48}catch(h){f.error(TAG,"Error parsing browser version.")}}}return b||d},a.main=function(){f.info(TAG,"Entering MainController.");var c=getRegistrationCodeParameter(b.absUrl()),e=getAuthCodeParameter(b.absUrl());errorHandlerUrl=getErrorHandlerUrlParameter(b.absUrl());var i=l.getPlatform(),j=l.getOS(),k={};a.isPlatformSupported(i)?-1==j.indexOf("Windows")&&-1==j.indexOf("Win32")&&-1==j.indexOf("Win64")&&-1==j.indexOf("Linux")&&-1==j.indexOf("Macintosh")&&-1==j.indexOf("MacIntel")&&-1==j.indexOf("MacPPC")&&-1==j.indexOf("Mac68K")?(f.error("TAG","Unsupported OS: "+i+"/"+j),k["error-type"]=g.ERROR_TYPE_UNSUPPORTED_PLATFORM,k["error-code"]=g.ERR_UNSUPPORTED_PLATFORM,showError(d,k)):e?c?(c=c.replace("%20","+"),h.register(c).then(function(b){f.info(TAG,"Successfully registered: "+JSON.stringify(b)),a.authenticate(e)},function(a){a["error-type"]=g.ERROR_TYPE_REGISTRATION,f.error(TAG,"Error while registering: "+JSON.stringify(a)),showError(d,a),f.publishLog()})):a.authenticate(e):c?(f.info(TAG,"Found registration code in URL request parameters: "+c),a.register(c)):h.getRegistrationCode()?(f.info(TAG,"Client already registered: "+h.getRegistrationCode()),a.isWelcomeContainerShowing=!0):b.path("registration"):(f.error("TAG","Unsupported platform: "+i+"/"+j),k["error-type"]=g.ERROR_TYPE_UNSUPPORTED_PLATFORM,k["error-code"]=g.ERR_UNSUPPORTED_PLATFORM,showError(d,k))},a.login=function(){b.path("login")},a.changeRegistration=function(){b.path("registration")},a.authenticate=function(b){f.info(TAG,"Found auth_code, starting login sequence.  auth_code: "+b),k.submitOperation(k.MetricOperation.WDLOGIN),k.submitOperation(k.MetricOperation.WDLOGIN_SUCCESS),k.startOperation(k.MetricOperation.SESSION_LAUNCH_TIME),a.isStatusContainerShowing=!0,a.isWarningContainerShowing=!1,a.statusDetail=$.i18n("ws-authenticating"),i.getWarpDriveUrl().then(function(c){f.info(TAG,"Loading warp drive url: "+c),i.authenticate(b,ws_login_uuid).then(function(b){f.info(TAG,"Successfully authenticated.  auth_token = "+JSON.stringify(b)),a.getResources()},function(a){f.error(TAG,"Error while authenticating: "+JSON.stringify(a)),a["error-type"]=g.ERROR_TYPE_AUTHENTICATION,a["health-state"]=i.health_state,showError(d,a),f.publishLog()})},function(a){f.error(TAG,"Error while getting the warp drive url: "+JSON.stringify(a)),a["error-type"]=g.ERROR_TYPE_WARPDRIVE,showError(d,a)})},a.getResources=function(){a.statusDetail=$.i18n("ws-getting-resource"),i.getResources().then(function(b){f.info(TAG,"Successfully obtained resource = "+JSON.stringify(b)),a.allocateResource(b)},function(a){f.error(TAG,"Error while getting the resource list: "+JSON.stringify(a)),a["error-type"]=g.ERROR_TYPE_GETRESOURCES,showError(d,a),f.publishLog()})},a.suspendedStateCallback=function(b){a.allocateResourceState=b,a.isResumingContainerShowing=!0,a.isStatusContainerShowing=!1,a.isWarningContainerShowing=!1},a.allocateResource=function(b){a.statusDetail=$.i18n("ws-allocating-resource"),i.allocateResource({resource_id:b["resource-id"],suspendedStateCallback:a.suspendedStateCallback}).then(function(b){f.info(TAG,"Successfully allocated the resource: creds = "+JSON.stringify(b)),a.connect(b)},function(a){f.error(TAG,"Error while allocating the resource: "+JSON.stringify(a)),a["error-type"]=g.ERROR_TYPE_CONNECTION,showError(d,a),f.publishLog()})},a.applyResolution=function(b){var c=j.getAvailableWorkArea();a.videoContainerWidth=c.width,a.videoContainerHeight=c.height,j.isFullScreen()?(a.videoWidth=$(window).width(),a.videoHeight=$(window).height()):(a.videoWidth=b.width,a.videoHeight=b.height);document.getElementById("stx-video");c.width<b.width||c.height<b.height?(a.videoLeft="0%",a.videoTop="0%",a.videoTransform="translate(0%,0%)"):(a.videoLeft="50%",a.videoTop="50%",a.videoTransform="translate(-50%, -50%)"),a.currentResolution=b},a.layCanvasOntop=function(){0===a.videoZIndex?(a.canvasZIndex=2,a.videoZIndex=1):(a.canvasZIndex=2,a.videoZIndex=0)},a.playVideo=function(a){var b=document.getElementById("stx-video");b.play(),$("#stx-play").hide()},a.canvasRender=function(a){var b=$(".stx-video"),c=$(".stx-canvas");window.devicePixelRatio>1&&!b[0].paused&&!b[0].ended&&b[0].readyState===b[0].HAVE_ENOUGH_DATA?(c.show(),a.drawImage(b[0],0,0,b.width(),b.height())):c.hide()},a.connect=function(b){a.statusDetail=$.i18n("ws-connecting");var c={creds:b,inputElement:$(".video-container")[0],videoElement:$(".stx-video")[0],canvasElement:$(".stx-canvas")[0],onDisconnect:a.onDisconnect};j.connect(c).then(function(b){f.info(TAG,"Successfully connected, resolution: "+JSON.stringify(b));var c=j.getAvailableWorkArea();a.videoContainerWidth=c.width,a.videoContainerHeight=c.height,a.videoWidth=b.width,a.videoHeight=b.height,a.currentResolution={width:Number.MAX_VALUE,height:Number.MAX_VALUE},a.applyResolution(b),$(window).resize(function(){f.info(TAG,"Window resize requested"),clearTimeout(a.resizeTimeout),a.resizeTimeout=setTimeout(function(){f.info(TAG,"Window resize finished."),a.layCanvasOntop(),j.changeResolution().then(function(b){a.applyResolution(b)},function(a){f.error(TAG,"Error while changing resolution. "+JSON.stringify(a))})},500)});var d=$(".stx-canvas")[0],e=d.getContext("2d");a.canvasRenderInterval=setInterval(a.canvasRender,50,e),a.isStatusContainerShowing=!1,a.isResumingContainerShowing=!1,a.isWarningContainerShowing=!1,g.hideError(a),a.isVideoContainerShowing=!0,a.videoZIndex=0,a.canvasZIndex=1},function(a){f.error(TAG,"Error while connecting: "+JSON.stringify(a)),a["error-type"]=g.ERROR_TYPE_CONNECTION,a["health-state"]=i.health_state,showError(d,a),f.publishLog()})},a.toggleFullScreen=function(){f.info(TAG,"Toggle fullscreen requested"),j.isFullScreen()?j.exitFullScreen():j.enterFullScreen()},a.onFullScreenChange=function(){f.info(TAG,"Full screen changed"),j.isFullScreen()?a.fullScreenText=$.i18n("ws-exit-full-screen"):a.fullScreenText=$.i18n("ws-enter-full-screen")},a.sendCtrlAltDel=function(){f.info(TAG,"Send CTRL-ALT-DEL requested."),j.sendCtrlAltDel()},a.disconnect=function(){j.disconnect(!0),f.publishLog(),c.location.href=WEB_CLIENT_URL},a.onDisconnect=function(b){f.info(TAG,"StreamingService disconnected with error: "+JSON.stringify(b)),a.canvasRenderInterval&&window.clearInterval(a.canvasRenderInterval),b["error-type"]=g.ERROR_TYPE_CONNECTION,showError(d,b),f.publishLog()},a.register=function(a){h.register(a).then(function(a){f.info(TAG,"Successfully registered: "+JSON.stringify(a)),b.path("login")},function(a){a["error-type"]=g.ERROR_TYPE_REGISTRATION,f.error(TAG,"Error while registering: "+JSON.stringify(a)),showError(d,a),f.publishLog()})},a.focusVideoContainer=function(a){a.currentTarget.focus()},a.videoMouseMove=function(){j.videoMouseMove()},a.menuMouseLeave=function(){a.pinMenu&&(a.showMenu=!1)},a.fullScreenText=$.i18n("ws-enter-full-screen"),a.pinMenu=!1,a.showMenu=!0,document.onfullscreenchange=a.onFullScreenChange;var n=$(".video-container")[0];n.addEventListener("webkitfullscreenchange",function(b){a.layCanvasOntop()},!1),n.addEventListener("mozfullscreenchange",function(b){a.layCanvasOntop()},!1),n.addEventListener("fullscreenchange",function(b){a.layCanvasOntop()},!1),a.isWarningContainerShowing=window.devicePixelRatio>1&&!Number.isInteger(window.devicePixelRatio),a.main()}]),workSpacesControllers.controller("RegistrationController",["$scope","$location","$state","$timeout","logger","errorHandlerService","registrationService","storageService",function(a,b,c,d,e,f,g,h){e.info(TAG,"Entering RegistrationController."),a.selectedLanguage=$.i18n.getLanguage(),$.i18n.setLanguage(a.selectedLanguage),a.updateSelectedLanguage=function(a){$.i18n.setLanguage(a)},d(function(){$.i18n.setLanguage($.i18n.getLanguage())}),a.registrationCode=g.getRegistrationCode(),a.registrationKeyDown=function(b){13===b.which&&a.register()},a.register=function(){f.hideError(a),e.info(TAG,"Entered registration code: "+a.registrationCode),g.register(a.registrationCode).then(function(a){e.info(TAG,"Successfully registered: "+JSON.stringify(a)),b.path("login")},function(a){a["error-type"]=f.ERROR_TYPE_REGISTRATION,e.error(TAG,"Error while registering: "+JSON.stringify(a)),showError(c,a),e.publishLog()})}}]),workSpacesControllers.controller("LoginController",["$scope","$window","$state","logger","errorHandlerService","connectionManagerService","metricsService",function(a,b,c,d,e,f,g){d.info(TAG,"Entering LoginController.");f.getWarpDriveUrl().then(function(a){d.info(TAG,"Loading warp drive url: "+a),g.startOperation(g.MetricOperation.WDLOGIN),b.location.href=a+"&locale="+$.i18n.getLanguage()},function(a){d.error(TAG,"Error while getting the warp drive url: "+JSON.stringify(a)),a["error-type"]=e.ERROR_TYPE_WARPDRIVE,showError(c,a)})}]),workSpacesControllers.controller("ErrorController",["$scope","$window","$location","$stateParams","logger","errorHandlerService","storageService",function(a,b,c,d,e,f,g){f.showError(a,{"error-type":d.errorType,"error-code":d.errorCode}),a.closeError=function(){d.errorType==f.ERROR_TYPE_REGISTRATION?b.history.back():b.location.href=WEB_CLIENT_URL}}]);
//# sourceMappingURL=workspaces.min.js.map@`      ^^AJ^}   :    :https://clients.amazonworkspaces.com/js/workspaces.min.js necko:classified 1 strongly-framed 1 security-info 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 request-method GET response-head HTTP/1.1 200 OK
Content-Type: text/javascript
Content-Length: 73949
Last-Modified: Tue, 19 May 2020 21:04:09 GMT
x-amz-server-side-encryption: AES256
Accept-Ranges: bytes
Server: AmazonS3
Date: Wed, 17 Jun 2020 23:29:53 GMT
ETag: "475d6e326611320ead9ba858f5feaba1"
X-Cache: Hit from cloudfront
Via: 1.1 ee8246c5442dace7525c74f6a799bb47.cloudfront.net (CloudFront)
X-Amz-Cf-Pop: SEA19-C2
X-Amz-Cf-Id: -7sS4FEc4_Wf8E_VbwFTf6bnY0brCboOtpax2Zb1abuNXIFgAjym8A==
Age: 70494
 original-response-headers Content-Type: text/javascript
Content-Length: 73949
Connection: keep-alive
Last-Modified: Tue, 19 May 2020 21:04:09 GMT
x-amz-server-side-encryption: AES256
Accept-Ranges: bytes
Server: AmazonS3
Date: Wed, 17 Jun 2020 23:29:53 GMT
ETag: "475d6e326611320ead9ba858f5feaba1"
X-Cache: Hit from cloudfront
Via: 1.1 ee8246c5442dace7525c74f6a799bb47.cloudfront.net (CloudFront)
X-Amz-Cf-Pop: SEA19-C2
X-Amz-Cf-Id: -7sS4FEc4_Wf8E_VbwFTf6bnY0brCboOtpax2Zb1abuNXIFgAjym8A==
Age: 70494
 ctid 2 eTLD1Access 1;0;1645175795, uncompressed-len 0 net-response-time-onstart 80 net-response-time-onstop 94   